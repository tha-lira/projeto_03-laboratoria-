# üìò Guia do Projeto 3 ‚Äì Risco Relativo

### üü¶ Processar e preparar a base de dados

#### üîµ Conectar/importar dados para ferramentas

- Projeto
ID: `projeto-risco-relativo-470919`
Descri√ß√£o: An√°lise de risco relativo dos clientes da institui√ß√£o financeira fict√≠cia SuperCaja.

- Dataset Principal
Nome: `bancoSuperCaja`
Descri√ß√£o: Re√∫ne informa√ß√µes cadastrais dos usu√°rios, detalhes dos empr√©stimos e dados de inadimpl√™ncia.

- Tabelas no Dataset

1. user_info ‚Äî Dados cadastrais (idade, sexo, sal√°rio, dependentes, etc.)

2. loans_outstanding ‚Äî Resumo dos empr√©stimos ativos (tipo, identificador)

3. loans_detail ‚Äî Detalhes dos empr√©stimos, incluindo atrasos e uso de cr√©dito

4. default ‚Äî Indicador de inadimpl√™ncia (default_flag)

---

#### üîµ  Identificar e tratar valores nulos

Foi realizada uma verifica√ß√£o de valores nulos nas tabelas `user_info`, `loans_outstanding`, `loans_detail` e `default`, utilizando a fun√ß√£o COUNTIF() combinada com o operador IS NULL. Essa abordagem permitiu identificar, em cada coluna, a quantidade de registros ausentes.

A an√°lise revelou que apenas duas vari√°veis da tabela `user_info` apresentam valores nulos:

- **last_month_salary**: 7.199 registros nulos (~20%)

- **number_dependents**: 943 registros nulos (~2.6%)

As demais colunas das outras tabelas est√£o completas e n√£o exigem tratamento adicional.

Ao fazer uma compara√ß√£o entre as vari√°veis last_month_salary e default_flag, os dados revelaram que:

- A propor√ß√£o de valores nulos entre inadimplentes (default_flag = 1) √©: 130 / 683 ‚âà 19,03%;

- A propor√ß√£o de valores nulos entre bons pagadores (default_flag = 0) √©: 7.069 / 35.317 ‚âà 20,02%.

Isso nos mostra que os percentuais de nulos s√£o quase iguais entre os dois grupos. Portanto, a aus√™ncia de sal√°rio declarado n√£o est√° associada √† inadimpl√™ncia neste caso.

üõ†Ô∏è As a√ß√µes corretivas para os campos nulos listados acima ser√£o a substitui√ß√£o dos valores pela mediana.

#### üîµ Identificar e tratar valores duplicados

Nenhuma das tabelas apresentou registros duplicados que exigissem tratamento ou exclus√£o. Todos os dados est√£o consistentes com a estrutura esperada de cada tabela. A checagem de duplicatas foi feita com GROUP BY, HAVING, e valida√ß√µes espec√≠ficas por tabela, garantindo a integridade das informa√ß√µes para as pr√≥ximas etapas da an√°lise.

üõ†Ô∏è Nenhuma a√ß√£o corretiva foi necess√°ria para valores duplicados.

#### üîµ Identificar e gerenciar dados fora do escopo de an√°lise

Para compreender melhor as rela√ß√µes entre vari√°veis num√©ricas e auxiliar na sele√ß√£o de vari√°veis relevantes para modelagem, foram realizadas an√°lises de correla√ß√£o utilizando a fun√ß√£o CORR().

| Vari√°veis Comparadas                                                                            | Correla√ß√£o |
| ----------------------------------------------------------------------------------------------- | ---------- |
| `more_90_days_overdue` √ó `number_times_delayed_payment_loan_30_59_days`                         | **0,98**   |
| `more_90_days_overdue` √ó `number_times_delayed_payment_loan_60_89_days`                         | **0,99**   |
| `number_times_delayed_payment_loan_30_59_days` √ó `number_times_delayed_payment_loan_60_89_days` | **0,99**   |
| `last_month_salary` √ó `debt_ratio`                                                              | -0,025     |
| `more_90_days_overdue` √ó `default_flag`                                                         | 0,31       |
| `debt_ratio` √ó `default_flag`                                                                   | -0,007     |

üõ†Ô∏è  Vari√°veis Eliminadas

| Vari√°vel                                       | Motivo da Remo√ß√£o                                                               |
| ---------------------------------------------- | ------------------------------------------------------------------------------- |
| `sex`                                          | Informa√ß√£o sens√≠vel ‚Äì exclus√£o por **√©tica/legalidade** em modelos de cr√©dito   |
| `number_times_delayed_payment_loan_30_59_days` | Alta correla√ß√£o com outras vari√°veis de atraso ‚Äì **redund√¢ncia** (corr > 0,98)  |
| `number_times_delayed_payment_loan_60_89_days` | Alta correla√ß√£o com outras vari√°veis de atraso ‚Äì **redund√¢ncia** (corr > 0,99)  |

[Consulta detalhada](https://github.com/tha-lira/projeto_03-laboratoria-/blob/main/dados_discrepantes.md)

#### üîµ Identificar e tratar dados discrepantes em vari√°veis ‚Äã‚Äãcateg√≥ricas

Foi utilizado a fun√ß√£o DISTINCT, para encontar inconsistencias de escritacnas variaveis catecoricas. com isso foram identificadas inconsist√™ncias nos valores registrados. Por exemplo, na vari√°vel **loan_type**, foram encontradas varia√ß√µes como "OTHER", "Other", "others" que foram unificadas em "other", e "REAL ESTATE", "Real Estate", "real estate". A padroniza√ß√£o desses valores foi realizada para garantir a uniformidade dos dados, evitar duplicidades e permitir an√°lises e modelagens mais precisas e confi√°veis.

#### üîµ Identificar e tratar dados discrepantes em vari√°veis ‚Äã‚Äãnum√©ricas

A etapa seguinte focou na detec√ß√£o de valores extremos (outliers) nas vari√°veis num√©ricas presentes nas tabelas. Para isso, foram utilizadas as fun√ß√µes APPROX_QUANTILES(), AVG() e STDDEV() no Google BigQuery, permitindo o c√°lculo dos quartis, m√©dia e desvio padr√£o para cada vari√°vel.  A partir desses c√°lculos, foram definidos os limites inferior e superior por meio do Intervalo Interquart√≠lico (IQR = Q3 ‚Äì Q1), sendo considerados outliers os valores acima de Q3 + 1,5*IQR ou abaixo de Q1 ‚Äì 1,5*IQR.

[Consulta detalhada das vari√°veis](https://github.com/tha-lira/projeto_03-laboratoria-/blob/main/dados_discrepantes.md)

#### üîµ Criar novas vari√°veis

Com base na tabela loans_outstanding, foi observado que cada cliente (user_id) pode possuir m√∫ltiplos empr√©stimos cadastrados. A fim de tornar esses dados mais √∫teis para an√°lise preditiva, foram criadas novas vari√°veis agregadas por cliente:

| Nova Vari√°vel          | Descri√ß√£o                                                               |
| ---------------------- | ----------------------------------------------------------------------- |
| `loan_count`           | Quantidade total de empr√©stimos feitos por um cliente                   |
| `count_real_estate`    | Quantidade de empr√©stimos do tipo ‚Äúreal estate‚Äù                         |
| `count_other`          | Quantidade de empr√©stimos do tipo ‚Äúother‚Äù                               |
| `has_real_estate_loan` | Indicador bin√°rio se o cliente fez ao menos um empr√©stimo ‚Äúreal estate‚Äù |
| `has_other_loan`       | Indicador bin√°rio se o cliente fez ao menos um empr√©stimo ‚Äúother‚Äù       |

Essas vari√°veis foram salvas na nova tabela loans_features e poder√£o ser utilizadas na modelagem de risco de cr√©dito. Elas representam o comportamento hist√≥rico do cliente em rela√ß√£o √† contrata√ß√£o de empr√©stimos.

#### üîµ Unir tabelas

Foi criado a tabela para uni√£o das bases `base_unificada`, foi realizado o tratamento dos valores nulos provenientes dos LEFT JOINs. Realizamos a uni√£o das tabelas user_info_tratada, loans_outstanding_tratada, loans_detail_tratada e default para criar uma base √∫nica e consistente para an√°lise de risco. A tabela user_info serviu como base principal, onde agregamos informa√ß√µes dos empr√©stimos da tabela loans_outstanding por cliente, criando vari√°veis que indicam quantidade e tipos de empr√©stimos. Em seguida, incorporamos detalhes dos empr√©stimos e hist√≥rico de atrasos da tabela loans_detail e adicionamos a vari√°vel-alvo de inadimpl√™ncia (default_flag) da tabela default. Utilizamos joins que preservam todos os clientes, mesmo aqueles sem registros em tabelas auxiliares, garantindo integridade e completude dos dados. Essa uni√£o permitiu consolidar o perfil financeiro dos clientes, facilitando an√°lises e a modelagem preditiva de risco de cr√©dito. 

[Tratamento individual das tabelas](https://github.com/tha-lira/projeto_03-laboratoria-/blob/main/tratamento.md)

Tabela `base_unificada`

| Vari√°vel                 | Tipo    | Descri√ß√£o                                                                        |
| ------------------------ | ------- | -------------------------------------------------------------------------------- |
| `user_id`                | INTEGER | Identificador √∫nico do cliente.                                                  |
| `age`                    | INTEGER | Idade do cliente.                                                                |
| `salary_last_month`      | FLOAT   | Sal√°rio do cliente no √∫ltimo m√™s (valores nulos tratados pela mediana).          |
| `dependents`             | INTEGER | N√∫mero de dependentes do cliente (nulos tratados como 0).                        |
| `loan_count`             | INTEGER | Quantidade total de empr√©stimos ativos do cliente.                               |
| `count_real_estate`      | INTEGER | Quantidade de empr√©stimos do tipo **real estate**.                               |
| `count_other`            | INTEGER | Quantidade de empr√©stimos do tipo **other**.                                     |
| `has_real_estate_loan`   | INTEGER | Indicador bin√°rio (0/1) se o cliente possui ao menos 1 empr√©stimo imobili√°rio.   |
| `has_other_loan`         | INTEGER | Indicador bin√°rio (0/1) se o cliente possui ao menos 1 empr√©stimo de outro tipo. |
| `overdue_90_days`        | INTEGER | Quantidade de vezes que o cliente atrasou mais de 90 dias no pagamento.          |
| `unsecured_credit_lines` | FLOAT   | Propor√ß√£o de linhas de cr√©dito n√£o garantidas por ativos pessoais.               |
| `debt_ratio`             | FLOAT   | Rela√ß√£o entre d√≠vidas e renda mensal do cliente.                                 |
| `default_flag`           | INTEGER | Indicador bin√°rio (0/1) se o cliente entrou em default.                          |

### üü™ Fazer uma an√°lise explorat√≥ria

#### üü£ Agrupar dados de acordo com vari√°veis ‚Äã‚Äãcateg√≥ricas
#### üü£ Visualizar vari√°veis ‚Äã‚Äãcateg√≥ricas
#### üü£ Aplicar medidas de tend√™ncia central
#### üü£ Ver distribui√ß√£o
#### üü£ Aplicar medidas de dispers√£o
#### üü£ Calcular quartis, decis ou percentis
#### üü£ Calcular correla√ß√£o entre vari√°veis

### üü• Aplicar t√©cnica de an√°lise

#### üî¥ Calcular o risco relativo
#### üî¥ Regress√£o log√≠stica
